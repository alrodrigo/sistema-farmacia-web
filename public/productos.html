<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos - Sistema Farmacia</title>
    
    <!-- Favicon -->
    <link rel="icon" href="img/logo-servisalud.png" type="image/png">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Sistema de Dise√±o Base -->
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/productos.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="navbar-left">
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">
                <img src="img/logo-servisalud.png" alt="ServiSalud Logo" class="logo-image">
                <span class="logo-text">ServiSalud</span>
            </div>
            <div class="navbar-search">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Buscar producto, cliente...">
            </div>
        </div>
        
        <div class="navbar-right">
            <button class="btn-icon" title="Notificaciones">
                <i class="fas fa-bell"></i>
            </button>
            <div class="user-menu">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-details">
                    <span class="user-name" id="userName">Cargando...</span>
                    <span class="user-role">Admin</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- ==================== CONTENEDOR PRINCIPAL ==================== -->
    <div class="main-container">
        
        <!-- ==================== SIDEBAR (Men√∫ lateral) ==================== -->
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="productos.html" class="nav-item active">
                    <i class="fas fa-pills"></i>
                    <span>Productos</span>
                </a>
                <a href="categorias.html" class="nav-item" id="menuCategorias">
                    <i class="fas fa-tags"></i>
                    <span>Categor√≠as</span>
                </a>
                <a href="ventas.html" class="nav-item">
                    <i class="fas fa-cash-register"></i>
                    <span>Ventas</span>
                </a>
                <a href="usuarios.html" class="nav-item" id="menuUsuarios">
                    <i class="fas fa-users"></i>
                    <span>Usuarios</span>
                </a>
                <a href="reportes.html" class="nav-item">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reportes</span>
                </a>
                <a href="configuracion.html" class="nav-item">
                    <i class="fas fa-cog"></i>
                    <span>Configuraci√≥n</span>
                </a>
            </nav>
        </aside>

        <!-- ==================== CONTENIDO PRINCIPAL ==================== -->
        <main class="content">
            <!-- Header de la p√°gina -->
            <div class="page-header">
                <div class="page-title">
                    <h1><i class="fas fa-pills"></i> Gesti√≥n de Productos</h1>
                    <p>Administra el inventario de tu farmacia</p>
                </div>
                <button class="btn-primary" id="btnNuevoProducto">
                    <i class="fas fa-plus"></i>
                    Nuevo Producto
                </button>
            </div>

            <!-- Barra de b√∫squeda y filtros -->
            <div class="filters-section">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Buscar por nombre, SKU o c√≥digo de barras..."
                    >
                </div>
                
                <div class="filter-group">
                    <select id="filterCategoria" class="filter-select">
                        <option value="">Todas las categor√≠as</option>
                        <!-- Se llenar√°n con JavaScript -->
                    </select>
                    
                    <select id="filterProveedor" class="filter-select">
                        <option value="">Todos los proveedores</option>
                        <!-- Se llenar√°n con JavaScript -->
                    </select>
                    
                    <select id="filterStock" class="filter-select">
                        <option value="">Todo el stock</option>
                        <option value="bajo">Stock bajo</option>
                        <option value="normal">Stock normal</option>
                        <option value="alto">Stock alto</option>
                    </select>
                    
                    <button class="btn-secondary" id="btnLimpiarFiltros">
                        <i class="fas fa-eraser"></i>
                        Limpiar
                    </button>
                </div>
            </div>

            <!-- Informaci√≥n r√°pida -->
            <div class="info-cards">
                <div class="info-card">
                    <div class="info-icon blue">
                        <i class="fas fa-boxes"></i>
                    </div>
                    <div class="info-content">
                        <span class="info-label">Total Productos</span>
                        <span class="info-value" id="totalProductos">0</span>
                    </div>
                </div>
                
                <div class="info-card">
                    <div class="info-icon green">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="info-content">
                        <span class="info-label">Valor Total Inventario</span>
                        <span class="info-value" id="valorInventario">$0.00</span>
                    </div>
                </div>
                
                <div class="info-card">
                    <div class="info-icon orange">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="info-content">
                        <span class="info-label">Stock Bajo</span>
                        <span class="info-value" id="stockBajo">0</span>
                    </div>
                </div>
                
                <div class="info-card">
                    <div class="info-icon purple">
                        <i class="fas fa-layer-group"></i>
                    </div>
                    <div class="info-content">
                        <span class="info-label">Categor√≠as</span>
                        <span class="info-value" id="totalCategorias">0</span>
                    </div>
                </div>
            </div>

            <!-- Tabla de productos -->
            <div class="table-container">
                <div class="table-header">
                    <h3><i class="fas fa-list"></i> Listado de Productos</h3>
                    <div class="table-actions">
                        <button class="btn-icon" id="btnExportar" title="Exportar a Excel">
                            <i class="fas fa-file-excel"></i>
                        </button>
                        <button class="btn-icon" id="btnImprimir" title="Imprimir">
                            <i class="fas fa-print"></i>
                        </button>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table class="productos-table" id="productosTable">
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Nombre</th>
                                <th>Categor√≠a</th>
                                <th>Proveedor</th>
                                <th>Stock</th>
                                <th>Stock M√≠n.</th>
                                <th>Precio</th>
                                <th>Estado</th>
                                <th class="text-center">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="productosTableBody">
                            <!-- Se llenar√° con JavaScript -->
                            <tr class="loading-row">
                                <td colspan="9" class="text-center">
                                    <i class="fas fa-spinner fa-spin"></i>
                                    Cargando productos...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Paginaci√≥n -->
                <div class="pagination" id="pagination">
                    <button class="pagination-btn" id="btnPrevPage" disabled>
                        <i class="fas fa-chevron-left"></i>
                        Anterior
                    </button>
                    <span class="pagination-info" id="paginationInfo">
                        P√°gina 1 de 1
                    </span>
                    <button class="pagination-btn" id="btnNextPage" disabled>
                        Siguiente
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

        </main>
    </div>

    <!-- Modal de Producto -->
    <div class="modal" id="productoModal">
        <div class="modal-overlay" id="modalOverlay"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">
                    <i class="fas fa-box"></i> 
                    <span id="modalTitleText">Nuevo Producto</span>
                </h2>
                <button class="modal-close" id="btnCerrarModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <form id="productoForm" class="modal-body">
                <!-- Informaci√≥n b√°sica -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-info-circle"></i> Informaci√≥n B√°sica
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="inputNombre">
                                Nombre del Producto <span class="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="inputNombre" 
                                class="form-control" 
                                placeholder="Ej: Paracetamol 500mg"
                                required
                            >
                            <span class="error-message" id="errorNombre"></span>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="inputSKU">
                                SKU <span class="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="inputSKU" 
                                class="form-control" 
                                placeholder="Ej: PARA-500"
                                required
                            >
                            <span class="error-message" id="errorSKU"></span>
                        </div>
                        
                        <div class="form-group">
                            <label for="inputBarcode">C√≥digo de Barras</label>
                            <input 
                                type="text" 
                                id="inputBarcode" 
                                class="form-control" 
                                placeholder="Ej: 7501234567890"
                            >
                        </div>
                    </div>
                </div>

                <!-- Clasificaci√≥n -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-tags"></i> Clasificaci√≥n
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="inputCategoria">
                                Categor√≠a <span class="required">*</span>
                            </label>
                            <div class="input-with-action">
                                <select id="inputCategoria" class="form-control" required>
                                    <option value="">Selecciona una categor√≠a</option>
                                    <!-- Se cargar√°n din√°micamente desde Firestore -->
                                </select>
                                <button type="button" class="btn-add-option" id="btnNuevaCategoria" title="Crear nueva categor√≠a">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <span class="error-message" id="errorCategoria"></span>
                        </div>
                        
                        <div class="form-group">
                            <label for="inputProveedor">
                                Laboratorio/Proveedor <span class="required">*</span>
                            </label>
                            <div class="input-with-action">
                                <select id="inputProveedor" class="form-control" required>
                                    <option value="">Selecciona un laboratorio</option>
                                    <!-- Se cargar√°n din√°micamente desde Firestore -->
                                </select>
                                <button type="button" class="btn-add-option" id="btnNuevoProveedor" title="Crear nuevo laboratorio">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <span class="error-message" id="errorProveedor"></span>
                        </div>
                    </div>
                </div>

                <!-- Precios -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-dollar-sign"></i> Precios
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="inputCosto">
                                Costo (sin IVA) <span class="required">*</span>
                            </label>
                            <input 
                                type="number" 
                                id="inputCosto" 
                                class="form-control" 
                                placeholder="0.00"
                                step="0.01"
                                min="0"
                                required
                            >
                            <span class="error-message" id="errorCosto"></span>
                        </div>
                        
                        <div class="form-group">
                            <label for="inputPrecio">
                                Precio de Venta <span class="required">*</span>
                            </label>
                            <input 
                                type="number" 
                                id="inputPrecio" 
                                class="form-control" 
                                placeholder="0.00"
                                step="0.01"
                                min="0"
                                required
                            >
                            <span class="error-message" id="errorPrecio"></span>
                        </div>
                        
                        <div class="form-group">
                            <label for="margenGanancia">Margen de Ganancia</label>
                            <input 
                                type="text" 
                                id="margenGanancia" 
                                class="form-control" 
                                readonly
                                placeholder="0%"
                            >
                        </div>
                    </div>
                </div>

                <!-- Inventario -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-boxes"></i> Inventario
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="inputStockActual">
                                Stock Actual <span class="required">*</span>
                            </label>
                            <input 
                                type="number" 
                                id="inputStockActual" 
                                class="form-control" 
                                placeholder="0"
                                min="0"
                                required
                            >
                            <span class="error-message" id="errorStockActual"></span>
                        </div>
                        
                        <div class="form-group">
                            <label for="inputStockMinimo">
                                Stock M√≠nimo <span class="required">*</span>
                            </label>
                            <input 
                                type="number" 
                                id="inputStockMinimo" 
                                class="form-control" 
                                placeholder="0"
                                min="0"
                                required
                            >
                            <span class="error-message" id="errorStockMinimo"></span>
                        </div>
                    </div>
                </div>

                <!-- Informaci√≥n adicional -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-file-alt"></i> Informaci√≥n Adicional
                    </h3>
                    
                    <div class="form-row">
                        <div class="form-group full-width">
                            <label for="inputDescripcion">Descripci√≥n</label>
                            <textarea 
                                id="inputDescripcion" 
                                class="form-control" 
                                rows="3"
                                placeholder="Descripci√≥n detallada del producto..."
                            ></textarea>
                        </div>
                    </div>
                </div>
            </form>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="btnCancelar">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button type="submit" form="productoForm" class="btn btn-primary" id="btnGuardar">
                    <i class="fas fa-save"></i> <span id="btnGuardarText">Guardar Producto</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ==================== MODAL R√ÅPIDO: NUEVA CATEGOR√çA ==================== -->
    <div class="quick-modal" id="modalNuevaCategoria">
        <div class="quick-modal-content">
            <div class="quick-modal-header">
                <h3><i class="fas fa-tag"></i> Nueva Categor√≠a</h3>
                <button type="button" class="quick-modal-close" id="btnCerrarNuevaCategoria">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="quick-modal-body">
                <div class="form-group">
                    <label for="inputNombreCategoria">
                        Nombre de la Categor√≠a <span class="required">*</span>
                    </label>
                    <input 
                        type="text" 
                        id="inputNombreCategoria" 
                        class="form-control" 
                        placeholder="Ej: Medicamentos, Vitaminas..."
                        maxlength="50"
                        autocomplete="off"
                    >
                </div>
                <div class="form-group">
                    <label for="inputDescripcionCategoria">
                        Descripci√≥n (Opcional)
                    </label>
                    <textarea 
                        id="inputDescripcionCategoria" 
                        class="form-control" 
                        placeholder="Descripci√≥n breve..."
                        rows="2"
                        maxlength="200"
                    ></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group" style="flex: 1;">
                        <label for="inputColorCategoria">Color</label>
                        <input 
                            type="color" 
                            id="inputColorCategoria" 
                            class="form-control color-input" 
                            value="#6a5acd"
                        >
                    </div>
                    <div class="form-group" style="flex: 2;">
                        <label for="inputIconoCategoria">Icono</label>
                        <select id="inputIconoCategoria" class="form-control">
                            <option value="fa-pills">üíä Pastillas</option>
                            <option value="fa-capsules">üíä C√°psulas</option>
                            <option value="fa-syringe">üíâ Jeringas</option>
                            <option value="fa-heartbeat">‚ù§Ô∏è Cardio</option>
                            <option value="fa-band-aid">ü©π Vendas</option>
                            <option value="fa-leaf">üçÉ Natural</option>
                            <option value="fa-baby">üë∂ Beb√©</option>
                            <option value="fa-tag">üè∑Ô∏è General</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="quick-modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" onclick="document.getElementById('btnCerrarNuevaCategoria').click()">
                    Cancelar
                </button>
                <button type="button" class="btn btn-primary btn-sm" id="btnGuardarCategoria">
                    <i class="fas fa-save"></i> Guardar
                </button>
            </div>
        </div>
    </div>

    <!-- ==================== MODAL R√ÅPIDO: NUEVO LABORATORIO ==================== -->
    <div class="quick-modal" id="modalNuevoProveedor">
        <div class="quick-modal-content">
            <div class="quick-modal-header">
                <h3><i class="fas fa-flask"></i> Nuevo Laboratorio</h3>
                <button type="button" class="quick-modal-close" id="btnCerrarNuevoProveedor">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="quick-modal-body">
                <div class="form-group">
                    <label for="inputNombreProveedor">
                        Nombre del Laboratorio <span class="required">*</span>
                    </label>
                    <input 
                        type="text" 
                        id="inputNombreProveedor" 
                        class="form-control" 
                        placeholder="Ej: Bayer, Pfizer, Novartis..."
                        maxlength="100"
                        autocomplete="off"
                    >
                </div>
                <div class="form-group">
                    <label for="inputPaisProveedor">
                        Pa√≠s (Opcional)
                    </label>
                    <input 
                        type="text" 
                        id="inputPaisProveedor" 
                        class="form-control" 
                        placeholder="Ej: M√©xico, Alemania, Estados Unidos..."
                        maxlength="50"
                    >
                </div>
            </div>
            <div class="quick-modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" onclick="document.getElementById('btnCerrarNuevoProveedor').click()">
                    Cancelar
                </button>
                <button type="button" class="btn btn-primary btn-sm" id="btnGuardarProveedor">
                    <i class="fas fa-save"></i> Guardar
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <!-- Configuraci√≥n de Firebase -->
    <script src="js/config/firebase.js"></script>

    <!-- Utilidades -->
    <script src="js/utils/helpers.js"></script>
    <script src="js/utils/roles.js"></script>

    <!-- Scripts de Productos -->
    <script src="js/productos.js"></script>
</body>
</html>
