<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Punto de Venta - Sistema Farmacia</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Sistema de DiseÃ±o Base -->
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/layout.css">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/ventas.css">
    <link rel="stylesheet" href="css/print.css">
</head>
<body>
    <!-- ==================== NAVBAR SUPERIOR ==================== -->
    <nav class="navbar">
        <div class="navbar-left">
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">
                <img src="img/logo-servisalud.png" alt="ServiSalud Logo" class="logo-image">
                <span class="logo-text">ServiSalud</span>
            </div>
            <div class="navbar-search">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Buscar producto, cliente...">
            </div>
        </div>
        
        <div class="navbar-right">
            <div class="user-menu">
                <div class="user-avatar">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-details">
                    <span class="user-name" id="userName">Cargando...</span>
                    <span class="user-role" id="userRole">Cargando...</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- ==================== CONTENEDOR PRINCIPAL ==================== -->
    <div class="main-container">
        
        <!-- ==================== SIDEBAR (MenÃº lateral) ==================== -->
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="ventas.html" class="nav-item active">
                    <i class="fas fa-cash-register"></i>
                    <span>Ventas</span>
                </a>
                <a href="productos.html" class="nav-item">
                    <i class="fas fa-pills"></i>
                    <span>Productos</span>
                </a>
                <a href="categorias.html" class="nav-item admin-only" id="menuCategorias">
                    <i class="fas fa-tags"></i>
                    <span>CategorÃ­as</span>
                </a>
                <a href="proveedores.html" class="nav-item admin-only">
                    <i class="fas fa-truck"></i>
                    <span>Proveedores</span>
                </a>
                <a href="usuarios.html" class="nav-item admin-only" id="menuUsuarios">
                    <i class="fas fa-users"></i>
                    <span>Usuarios</span>
                </a>
                <a href="reportes.html" class="nav-item">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reportes</span>
                </a>
            </nav>
        </aside>

        <!-- ==================== CONTENIDO PRINCIPAL ==================== -->
        <main class="content">
            <!-- Header de la pÃ¡gina -->
            <div class="content-header">
                <div>
                    <h1><i class="fas fa-cash-register"></i> Punto de Venta (POS)</h1>
                    <p>Registra las ventas de tu farmacia</p>
                </div>
                <div class="header-actions">
                    <span class="sale-number">Venta #<span id="saleNumber">0001</span></span>
                    <span class="sale-date" id="saleDate">12/11/2025 - 10:30 AM</span>
                </div>
            </div>

            <!-- Layout de 2 columnas: BÃºsqueda + Carrito -->
            <div class="pos-layout">
                
                <!-- ===== COLUMNA IZQUIERDA: BÃºsqueda de productos ===== -->
                <div class="pos-left">
                    
                    <!-- BÃºsqueda -->
                    <div class="search-section">
                        <h3><i class="fas fa-search"></i> Buscar Producto</h3>
                        <div class="search-box">
                            <input 
                                type="text" 
                                id="searchProductInput" 
                                placeholder="Buscar por nombre, SKU o cÃ³digo de barras..."
                                autofocus
                            >
                            <button class="btn-search" id="btnSearch">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <div class="search-tips">
                            ðŸ’¡ <strong>Tip:</strong> Puedes escanear el cÃ³digo de barras directamente
                        </div>
                    </div>

                    <!-- Resultados de bÃºsqueda -->
                    <div class="results-section">
                        <div class="results-header">
                            <h3><i class="fas fa-box-open"></i> Productos Disponibles</h3>
                            <span class="results-count" id="resultsCount">0 productos</span>
                        </div>
                        
                        <div class="results-container" id="searchResults">
                            <!-- Mensaje inicial -->
                            <div class="empty-results">
                                <i class="fas fa-barcode"></i>
                                <p>Busca un producto para comenzar</p>
                                <small>Usa el buscador o escanea el cÃ³digo de barras</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ===== COLUMNA DERECHA: Carrito y total ===== -->
                <div class="pos-right">
                    
                    <!-- Carrito de compra -->
                    <div class="cart-section">
                        <div class="cart-header">
                            <h3><i class="fas fa-shopping-cart"></i> Carrito de Venta</h3>
                            <button class="btn-clear-cart" id="btnClearCart" disabled>
                                <i class="fas fa-trash"></i> Limpiar
                            </button>
                        </div>

                        <div class="cart-container" id="cartContainer">
                            <!-- Carrito vacÃ­o inicial -->
                            <div class="empty-cart">
                                <i class="fas fa-shopping-cart"></i>
                                <p>El carrito estÃ¡ vacÃ­o</p>
                                <small>Agrega productos desde el buscador</small>
                            </div>
                        </div>
                    </div>

                    <!-- Resumen de la venta -->
                    <div class="summary-section">
                        <h3><i class="fas fa-calculator"></i> Resumen de Venta</h3>
                        <!-- Resumen del carrito -->
                        <div class="cart-summary">
                            <div class="summary-row">
                                <span>Productos:</span>
                                <strong id="totalItems">0</strong>
                            </div>
                            <div class="summary-row">
                                <span>Subtotal:</span>
                                <strong id="subtotal">Bs. 0.00</strong>
                            </div>
                            
                            <!-- Descuento -->
                            <div class="discount-section">
                                <label>
                                    <i class="fas fa-percent"></i> Descuento:
                                </label>
                                <div class="discount-inputs">
                                    <input type="number" id="discountValue" placeholder="0" min="0" step="0.01">
                                    <select id="discountType">
                                        <option value="percent">%</option>
                                        <option value="fixed">Bs.</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="summary-row" id="discountRow" style="display: none;">
                                <span>Descuento:</span>
                                <strong id="discountAmount" class="text-success">- Bs. 0.00</strong>
                            </div>
                            
                            <div class="summary-row total-row">
                                <span>TOTAL A PAGAR:</span>
                                <strong id="total">Bs. 0.00</strong>
                            </div>
                            
                            <!-- MÃ©todo de pago -->
                            <div class="payment-section">
                                <label for="paymentMethod">
                                    <i class="fas fa-credit-card"></i> MÃ©todo de pago:
                                </label>
                                <select id="paymentMethod" class="payment-select">
                                    <option value="cash">Efectivo</option>
                                    <option value="card">Tarjeta</option>
                                    <option value="transfer">Transferencia</option>
                                </select>
                            </div>
                            
                            <!-- Monto recibido (solo para efectivo) -->
                            <div class="amount-section" id="amountSection">
                                <label for="amountReceived">
                                    <i class="fas fa-money-bill-wave"></i> Monto recibido:
                                </label>
                                <input type="number" id="amountReceived" placeholder="0.00" min="0" step="0.01">
                            </div>
                            
                            <!-- Cambio -->
                            <div class="summary-row change-row" id="changeRow" style="display: none;">
                                <span>Cambio:</span>
                                <strong id="changeAmount" class="text-primary">Bs. 0.00</strong>
                            </div>
                        </div>

                        <!-- Botones de acciÃ³n -->
                        <div class="action-buttons">
                            <button class="btn-cancel" id="btnCancelSale">
                                <i class="fas fa-times"></i>
                                Cancelar Venta
                            </button>
                            <button class="btn-process" id="btnProcessSale" disabled>
                                <i class="fas fa-check-circle"></i>
                                Procesar Venta
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- ==================== MODAL DE VENTA EXITOSA ==================== -->
    <div id="saleSuccessModal" class="modal-sale-overlay" style="display: none;">
        <div class="modal-sale">
            <div class="modal-header success">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h2>Â¡Venta Procesada Exitosamente!</h2>
                <button class="modal-close" id="closeModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="sale-info">
                    <div class="info-row">
                        <span class="label">NÂº de Venta:</span>
                        <strong class="value" id="modalSaleNumber">0001</strong>
                    </div>
                    <div class="info-row">
                        <span class="label">Productos:</span>
                        <strong class="value" id="modalItems">0</strong>
                    </div>
                    <div class="info-row" id="modalDiscountRow" style="display: none;">
                        <span class="label">Descuento:</span>
                        <strong class="value text-success" id="modalDiscount">Bs. 0.00</strong>
                    </div>
                    <div class="info-row total">
                        <span class="label">Total:</span>
                        <strong class="value" id="modalTotal">Bs. 0.00</strong>
                    </div>
                    <div class="info-row">
                        <span class="label">MÃ©todo de Pago:</span>
                        <strong class="value" id="modalPaymentMethod">Efectivo</strong>
                    </div>
                    <div class="info-row" id="modalAmountRow" style="display: none;">
                        <span class="label">Monto Recibido:</span>
                        <strong class="value" id="modalAmountReceived">Bs. 0.00</strong>
                    </div>
                    <div class="info-row" id="modalChangeRow" style="display: none;">
                        <span class="label">Cambio:</span>
                        <strong class="value text-primary" id="modalChange">Bs. 0.00</strong>
                    </div>
                </div>

                <div class="sale-actions">
                    <button class="btn-print" id="btnPrintReceipt">
                        <i class="fas fa-print"></i>
                        Imprimir Recibo
                    </button>
                    <button class="btn-new-sale" id="btnNewSale">
                        <i class="fas fa-plus-circle"></i>
                        Nueva Venta
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== TEMPLATE DE RECIBO PARA IMPRESIÃ“N ==================== -->
    <div id="printReceipt" style="display: none;">
        <!-- El contenido se genera dinÃ¡micamente por JavaScript -->
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- ConfiguraciÃ³n de Firebase -->
    <script src="js/config/firebase.js"></script>

    <!-- Utilidades -->
    <script src="js/utils/helpers.js"></script>
    <script src="js/utils/roles.js"></script>

    <!-- Scripts de Ventas -->
    <script src="js/ventas.js"></script>
</body>
</html>
